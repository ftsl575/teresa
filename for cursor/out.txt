Windows PowerShell
(C) Корпорация Майкрософт (Microsoft Corporation). Все права защищены.

Попробуйте новую кроссплатформенную оболочку PowerShell (https://aka.ms/pscore6)

PS C:\Users\G> Set-Location -Path "C:\Users\G\Desktop\TERESA\dell_spec_classifier"
>>
>> pytest tests/test_device_type.py -v --tb=short
>> pytest tests/test_unknown_threshold.py -v --tb=short
>> pytest tests/test_smoke.py tests/test_regression.py -v --tb=short
>> pytest tests/ -v --tb=short 2>&1 | Tee-Object "C:\Users\G\Desktop\TERESA\dell_spec_classifier\out_test_phase2.txt"
================================================= test session starts =================================================
platform win32 -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\G\AppData\Local\Programs\Python\Python313\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\G\Desktop\TERESA\dell_spec_classifier
plugins: anyio-4.11.0
collected 20 items

tests/test_device_type.py::test_power_cord_rack_c13_c14 PASSED                                                   [  5%]
tests/test_device_type.py::test_power_cord_c19_c20 PASSED                                                        [ 10%]
tests/test_device_type.py::test_power_cord_jumper PASSED                                                         [ 15%]
tests/test_device_type.py::test_storage_ssd_cus_kit PASSED                                                       [ 20%]
tests/test_device_type.py::test_storage_nvme_customer_kit PASSED                                                 [ 25%]
tests/test_device_type.py::test_psu_800w_customer_kit PASSED                                                     [ 30%]
tests/test_device_type.py::test_psu_1500w_titanium_ck PASSED                                                     [ 35%]
tests/test_device_type.py::test_nic_intel_e810_customer_kit PASSED                                               [ 40%]
tests/test_device_type.py::test_nic_broadcom_ocp_customer_install PASSED                                         [ 45%]
tests/test_device_type.py::test_sfp_cable_twinax_3m PASSED                                                       [ 50%]
tests/test_device_type.py::test_sfp_cable_cus_kit PASSED                                                         [ 55%]
tests/test_device_type.py::test_hba_full_height_dib PASSED                                                       [ 60%]
tests/test_device_type.py::test_hba_full_height_low_profile_ck PASSED                                            [ 65%]
tests/test_device_type.py::test_perc_controller_ck PASSED                                                        [ 70%]
tests/test_device_type.py::test_fibre_channel_hba PASSED                                                         [ 75%]
tests/test_device_type.py::test_cpu_xeon_customer_install PASSED                                                 [ 80%]
tests/test_device_type.py::test_cpu_xeon_6511p_ck PASSED                                                         [ 85%]
tests/test_device_type.py::test_unknown_row_has_no_device_type PASSED                                            [ 90%]
tests/test_device_type.py::test_header_row_no_device_type PASSED                                                 [ 95%]
tests/test_device_type.py::test_base_row_no_device_type PASSED                                                   [100%]

================================================= 20 passed in 0.23s ==================================================
================================================= test session starts =================================================
platform win32 -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\G\AppData\Local\Programs\Python\Python313\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\G\Desktop\TERESA\dell_spec_classifier
plugins: anyio-4.11.0
collected 5 items

tests/test_unknown_threshold.py::test_unknown_ratio_below_threshold[dl1.xlsx] PASSED                             [ 20%]
tests/test_unknown_threshold.py::test_unknown_ratio_below_threshold[dl2.xlsx] PASSED                             [ 40%]
tests/test_unknown_threshold.py::test_unknown_ratio_below_threshold[dl3.xlsx] PASSED                             [ 60%]
tests/test_unknown_threshold.py::test_unknown_ratio_below_threshold[dl4.xlsx] PASSED                             [ 80%]
tests/test_unknown_threshold.py::test_unknown_ratio_below_threshold[dl5.xlsx] PASSED                             [100%]

================================================== warnings summary ===================================================
tests/test_unknown_threshold.py: 20 warnings
  C:\Users\G\AppData\Local\Programs\Python\Python313\Lib\site-packages\openpyxl\packaging\core.py:99: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = datetime.datetime.utcnow()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================================== 5 passed, 20 warnings in 0.59s ============================================
================================================= test session starts =================================================
platform win32 -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\G\AppData\Local\Programs\Python\Python313\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\G\Desktop\TERESA\dell_spec_classifier
plugins: anyio-4.11.0
collected 10 items

tests/test_smoke.py::test_smoke_full_pipeline_artifacts_created[dl1.xlsx] PASSED                                 [ 10%]
tests/test_smoke.py::test_smoke_full_pipeline_artifacts_created[dl2.xlsx] PASSED                                 [ 20%]
tests/test_smoke.py::test_smoke_full_pipeline_artifacts_created[dl3.xlsx] PASSED                                 [ 30%]
tests/test_smoke.py::test_smoke_full_pipeline_artifacts_created[dl4.xlsx] PASSED                                 [ 40%]
tests/test_smoke.py::test_smoke_full_pipeline_artifacts_created[dl5.xlsx] PASSED                                 [ 50%]
tests/test_regression.py::test_regression[dl1.xlsx] PASSED                                                       [ 60%]
tests/test_regression.py::test_regression[dl2.xlsx] PASSED                                                       [ 70%]
tests/test_regression.py::test_regression[dl3.xlsx] PASSED                                                       [ 80%]
tests/test_regression.py::test_regression[dl4.xlsx] PASSED                                                       [ 90%]
tests/test_regression.py::test_regression[dl5.xlsx] PASSED                                                       [100%]

================================================== warnings summary ===================================================
tests/test_smoke.py: 20 warnings
tests/test_regression.py: 20 warnings
  C:\Users\G\AppData\Local\Programs\Python\Python313\Lib\site-packages\openpyxl\packaging\core.py:99: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = datetime.datetime.utcnow()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================================== 10 passed, 40 warnings in 0.77s ===========================================
============================= test session starts =============================
platform win32 -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\G\AppData\Local\Programs\Python\Python313\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\G\Desktop\TERESA\dell_spec_classifier
plugins: anyio-4.11.0
collecting ... collected 78 items

tests/test_annotated_writer.py::test_annotated_excel_exists_same_rows_has_entity_type_state_and_item_values PASSED [  1%]
tests/test_cli.py::test_cli_exit_code_stdout_artifacts PASSED            [  2%]
tests/test_device_type.py::test_power_cord_rack_c13_c14 PASSED           [  3%]
tests/test_device_type.py::test_power_cord_c19_c20 PASSED                [  5%]
tests/test_device_type.py::test_power_cord_jumper PASSED                 [  6%]
tests/test_device_type.py::test_storage_ssd_cus_kit PASSED               [  7%]
tests/test_device_type.py::test_storage_nvme_customer_kit PASSED         [  8%]
tests/test_device_type.py::test_psu_800w_customer_kit PASSED             [ 10%]
tests/test_device_type.py::test_psu_1500w_titanium_ck PASSED             [ 11%]
tests/test_device_type.py::test_nic_intel_e810_customer_kit PASSED       [ 12%]
tests/test_device_type.py::test_nic_broadcom_ocp_customer_install PASSED [ 14%]
tests/test_device_type.py::test_sfp_cable_twinax_3m PASSED               [ 15%]
tests/test_device_type.py::test_sfp_cable_cus_kit PASSED                 [ 16%]
tests/test_device_type.py::test_hba_full_height_dib PASSED               [ 17%]
tests/test_device_type.py::test_hba_full_height_low_profile_ck PASSED    [ 19%]
tests/test_device_type.py::test_perc_controller_ck PASSED                [ 20%]
tests/test_device_type.py::test_fibre_channel_hba PASSED                 [ 21%]
tests/test_device_type.py::test_cpu_xeon_customer_install PASSED         [ 23%]
tests/test_device_type.py::test_cpu_xeon_6511p_ck PASSED                 [ 24%]
tests/test_device_type.py::test_unknown_row_has_no_device_type PASSED    [ 25%]
tests/test_device_type.py::test_header_row_no_device_type PASSED         [ 26%]
tests/test_device_type.py::test_base_row_no_device_type PASSED           [ 28%]
tests/test_excel_writer.py::test_excel_writer_file_exists_no_headers_only_include_types_and_present PASSED [ 29%]
tests/test_normalizer.py::test_detect_row_kind_header_all_empty_strings PASSED [ 30%]
tests/test_normalizer.py::test_detect_row_kind_header_all_none PASSED    [ 32%]
tests/test_normalizer.py::test_detect_row_kind_header_whitespace_only PASSED [ 33%]
tests/test_normalizer.py::test_detect_row_kind_item_module_name_set PASSED [ 34%]
tests/test_normalizer.py::test_detect_row_kind_item_option_name_set PASSED [ 35%]
tests/test_normalizer.py::test_detect_row_kind_item_skus_set PASSED      [ 37%]
tests/test_normalizer.py::test_detect_row_kind_item_all_set PASSED       [ 38%]
tests/test_normalizer.py::test_normalize_row_header_row PASSED           [ 39%]
tests/test_normalizer.py::test_normalize_row_item_single_sku PASSED      [ 41%]
tests/test_normalizer.py::test_normalize_row_multiple_skus PASSED        [ 42%]
tests/test_normalizer.py::test_normalize_row_nan_handling PASSED         [ 43%]
tests/test_regression.py::test_regression[dl1.xlsx] PASSED               [ 44%]
tests/test_regression.py::test_regression[dl2.xlsx] PASSED               [ 46%]
tests/test_regression.py::test_regression[dl3.xlsx] PASSED               [ 47%]
tests/test_regression.py::test_regression[dl4.xlsx] PASSED               [ 48%]
tests/test_regression.py::test_regression[dl5.xlsx] PASSED               [ 50%]
tests/test_rules_unit.py::test_header_skip PASSED                        [ 51%]
tests/test_rules_unit.py::test_base_detection PASSED                     [ 52%]
tests/test_rules_unit.py::test_base_poweredge PASSED                     [ 53%]
tests/test_rules_unit.py::test_base_poweredge_r6715 PASSED               [ 55%]
tests/test_rules_unit.py::test_software_embedded_systems PASSED          [ 56%]
tests/test_rules_unit.py::test_software_dell_secure_onboarding PASSED    [ 57%]
tests/test_rules_unit.py::test_software_os_media PASSED                  [ 58%]
tests/test_rules_unit.py::test_software_option_name_license PASSED       [ 60%]
tests/test_rules_unit.py::test_hw_chassis_config PASSED                  [ 61%]
tests/test_rules_unit.py::test_hw_processor PASSED                       [ 62%]
tests/test_rules_unit.py::test_hw_tpm PASSED                             [ 64%]
tests/test_rules_unit.py::test_service_prosupport PASSED                 [ 65%]
tests/test_rules_unit.py::test_service_warranty PASSED                   [ 66%]
tests/test_rules_unit.py::test_service_no_warranty_upgrade PASSED        [ 67%]
tests/test_rules_unit.py::test_logistic_shipping PASSED                  [ 69%]
tests/test_rules_unit.py::test_note_supports PASSED                      [ 70%]
tests/test_rules_unit.py::test_note_motherboard PASSED                   [ 71%]
tests/test_rules_unit.py::test_config_raid PASSED                        [ 73%]
tests/test_rules_unit.py::test_unknown_no_match PASSED                   [ 74%]
tests/test_rules_unit.py::test_state_absent_in_classification PASSED     [ 75%]
tests/test_rules_unit.py::test_state_disabled_in_classification PASSED   [ 76%]
tests/test_smoke.py::test_smoke_full_pipeline_artifacts_created[dl1.xlsx] PASSED [ 78%]
tests/test_smoke.py::test_smoke_full_pipeline_artifacts_created[dl2.xlsx] PASSED [ 79%]
tests/test_smoke.py::test_smoke_full_pipeline_artifacts_created[dl3.xlsx] PASSED [ 80%]
tests/test_smoke.py::test_smoke_full_pipeline_artifacts_created[dl4.xlsx] PASSED [ 82%]
tests/test_smoke.py::test_smoke_full_pipeline_artifacts_created[dl5.xlsx] PASSED [ 83%]
tests/test_state_detector.py::test_no_trusted_platform_module_absent PASSED [ 84%]
tests/test_state_detector.py::test_dell_connectivity_client_disabled PASSED [ 85%]
tests/test_state_detector.py::test_intel_xeon_present PASSED             [ 87%]
tests/test_state_detector.py::test_no_hdd_absent PASSED                  [ 88%]
tests/test_state_detector.py::test_none_keyword_absent PASSED            [ 89%]
tests/test_state_detector.py::test_empty_option_present PASSED           [ 91%]
tests/test_state_detector.py::test_disabled_only PASSED                  [ 92%]
tests/test_state_detector.py::test_not_included_absent PASSED            [ 93%]
tests/test_unknown_threshold.py::test_unknown_ratio_below_threshold[dl1.xlsx] PASSED [ 94%]
tests/test_unknown_threshold.py::test_unknown_ratio_below_threshold[dl2.xlsx] PASSED [ 96%]
tests/test_unknown_threshold.py::test_unknown_ratio_below_threshold[dl3.xlsx] PASSED [ 97%]
tests/test_unknown_threshold.py::test_unknown_ratio_below_threshold[dl4.xlsx] PASSED [ 98%]
tests/test_unknown_threshold.py::test_unknown_ratio_below_threshold[dl5.xlsx] PASSED [100%]

============================== warnings summary ===============================
tests/test_annotated_writer.py: 13 warnings
tests/test_excel_writer.py: 7 warnings
tests/test_regression.py: 20 warnings
tests/test_smoke.py: 20 warnings
tests/test_unknown_threshold.py: 20 warnings
  C:\Users\G\AppData\Local\Programs\Python\Python313\Lib\site-packages\openpyxl\packaging\core.py:99: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = datetime.datetime.utcnow()

tests/test_annotated_writer.py::test_annotated_excel_exists_same_rows_has_entity_type_state_and_item_values
tests/test_excel_writer.py::test_excel_writer_file_exists_no_headers_only_include_types_and_present
  C:\Users\G\AppData\Local\Programs\Python\Python313\Lib\site-packages\openpyxl\writer\excel.py:292: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    workbook.properties.modified = datetime.datetime.utcnow()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
======================= 78 passed, 82 warnings in 1.99s =======================
PS C:\Users\G\Desktop\TERESA\dell_spec_classifier> Set-Location -Path "C:\Users\G\Desktop\TERESA\dell_spec_classifier"
>>
>> python main.py --input "test_data\dl1.xlsx" --output-dir "output\vnext_phase2_check\dl1"
>> python main.py --input "test_data\dl3.xlsx" --output-dir "output\vnext_phase2_check\dl3"
>>
>> # Проверить summary:
>> Get-Content "output\vnext_phase2_check\dl1\*\run_summary.json" | ConvertFrom-Json | Select-Object unknown_count, item_rows_count, device_type_counts
>> Get-Content "output\vnext_phase2_check\dl3\*\run_summary.json" | ConvertFrom-Json | Select-Object unknown_count, item_rows_count, device_type_counts
2026-02-23 23:24:38 [INFO] Parsing Excel: C:\Users\G\Desktop\TERESA\dell_spec_classifier\test_data\dl1.xlsx
2026-02-23 23:24:38 [INFO] Normalizing rows (row_kind)...
2026-02-23 23:24:38 [INFO] Loading rules: C:\Users\G\Desktop\TERESA\dell_spec_classifier\rules\dell_rules.yaml
2026-02-23 23:24:38 [INFO] Classifying rows...
2026-02-23 23:24:38 [INFO] Saving artifacts to C:\Users\G\Desktop\TERESA\dell_spec_classifier\output\vnext_phase2_check\dl1\run_20260223_232438
2026-02-23 23:24:38 [INFO] Done.
Summary:
  total_rows: 56
  header_rows_count: 7
  item_rows_count: 49
  entity_type_counts: {'BASE': 1, 'HW': 24, 'CONFIG': 5, 'LOGISTIC': 7, 'NOTE': 1, 'SOFTWARE': 7, 'SERVICE': 4}
  unknown_count: 0
  run_folder: C:\Users\G\Desktop\TERESA\dell_spec_classifier\output\vnext_phase2_check\dl1\run_20260223_232438
2026-02-23 23:24:38 [INFO] Parsing Excel: C:\Users\G\Desktop\TERESA\dell_spec_classifier\test_data\dl3.xlsx
2026-02-23 23:24:38 [INFO] Normalizing rows (row_kind)...
2026-02-23 23:24:38 [INFO] Loading rules: C:\Users\G\Desktop\TERESA\dell_spec_classifier\rules\dell_rules.yaml
2026-02-23 23:24:38 [INFO] Classifying rows...
2026-02-23 23:24:38 [INFO] Saving artifacts to C:\Users\G\Desktop\TERESA\dell_spec_classifier\output\vnext_phase2_check\dl3\run_20260223_232438
2026-02-23 23:24:38 [INFO] Done.
Summary:
  total_rows: 102
  header_rows_count: 13
  item_rows_count: 89
  entity_type_counts: {'BASE': 2, 'HW': 44, 'CONFIG': 10, 'SOFTWARE': 12, 'LOGISTIC': 13, 'NOTE': 2, 'SERVICE': 6}
  unknown_count: 0
  run_folder: C:\Users\G\Desktop\TERESA\dell_spec_classifier\output\vnext_phase2_check\dl3\run_20260223_232438

unknown_count item_rows_count device_type_counts
------------- --------------- ------------------
            0              49 @{raid_controller=1; power_cord=1; storage_ssd=1; psu=1; nic=1}
            0              89 @{power_cord=2; raid_controller=2; hba=2; sfp_cable=2; nic=1; psu=1; storage_nvme=1; c...


PS C:\Users\G\Desktop\TERESA\dell_spec_classifier> # device_type не должен быть заполнен у matched_rule_id = UNKNOWN-000
>> Get-Content "output\vnext_phase2_check\dl1\*\classification.jsonl" | ConvertFrom-Json `
>> | Where-Object { $_.matched_rule_id -eq "UNKNOWN-000" -and $_.device_type } `
>> | Measure-Object
>>
>> # device_type не должен быть заполнен у BASE/CONFIG/SOFTWARE/SERVICE/NOTE/HEADER
>> Get-Content "output\vnext_phase2_check\dl1\*\classification.jsonl" | ConvertFrom-Json `
>> | Where-Object { $_.entity_type -in @("BASE","CONFIG","SOFTWARE","SERVICE","NOTE") -and $_.device_type } `
>> | Select-Object -First 20


Count    : 0
Average  :
Sum      :
Maximum  :
Minimum  :
Property :



PS C:\Users\G\Desktop\TERESA\dell_spec_classifier>